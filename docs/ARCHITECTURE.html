<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yole - Architecture</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <nav>
        <a href="index.html">Home</a> |
        <a href="README.html">Guides</a> |
        <a href="QUICK_START.html">README</a>
    </nav>

    <main style="padding: 20px;">
        <h1>Yole Cross-Platform Architecture</h1>
<h2>Overview</h2>
<p>Yole is a cross-platform text editor supporting Android, Desktop, iOS, and Web platforms with 18+ text formats. This document describes the architecture, module structure, and implementation details.</p>
<h2>Module Structure</h2>
<h3>Platform-Specific Applications</h3>
<h4><code>androidApp</code> - Android Application</h4>
<ul>
<li><strong>Purpose</strong>: Native Android application with modern Android development practices</li>
<li><strong>Key Components</strong>:</li>
<li>Native Android UI components</li>
<li>Android-specific file system access</li>
<li>Platform-optimized performance</li>
<li><strong>Technologies</strong>: AndroidX, Kotlin, modern Android architecture</li>
</ul>
<h4><code>desktopApp</code> - Desktop Application</h4>
<ul>
<li><strong>Purpose</strong>: Native desktop application for Windows, macOS, and Linux</li>
<li><strong>Key Components</strong>:</li>
<li>Desktop-specific UI framework</li>
<li>Native file system integration</li>
<li>Cross-platform desktop support</li>
<li><strong>Technologies</strong>: Compose Desktop, Kotlin</li>
</ul>
<h4><code>iosApp</code> - iOS Application</h4>
<ul>
<li><strong>Purpose</strong>: Native iOS application</li>
<li><strong>Key Components</strong>:</li>
<li>iOS-specific UI components</li>
<li>iOS file system integration</li>
<li>Apple ecosystem integration</li>
<li><strong>Technologies</strong>: SwiftUI or UIKit, platform-specific development</li>
</ul>
<h4><code>webApp</code> - Web Application</h4>
<ul>
<li><strong>Purpose</strong>: Progressive Web App with modern web technologies</li>
<li><strong>Key Components</strong>:</li>
<li>Web-specific UI framework</li>
<li>Browser-based file handling</li>
<li>PWA capabilities</li>
<li><strong>Technologies</strong>: WebAssembly, modern web development</li>
</ul>
<h3>Legacy Android Modules</h3>
<h4><code>commons</code> - Shared Utilities</h4>
<ul>
<li><strong>Purpose</strong>: Contains shared utilities, base classes, and interfaces used across Android modules</li>
<li><strong>Key Components</strong>:</li>
<li><code>GsFileUtils</code> - File operations and utilities</li>
<li><code>GsContextUtils</code> - Android context utilities</li>
<li><code>GsCollectionUtils</code> - Collection manipulation utilities</li>
<li>Base classes for format implementations</li>
</ul>
<h4><code>core</code> - Core Functionality</h4>
<ul>
<li><strong>Purpose</strong>: Contains reusable editors, syntax highlighters, and text converters</li>
<li><strong>Key Components</strong>:</li>
<li>Android-specific implementations</li>
<li><code>TextConverterBase</code> - Base class for text format converters</li>
<li><code>SyntaxHighlighterBase</code> - Base class for syntax highlighters</li>
<li><code>ActionButtonBase</code> - Base class for format-specific action buttons</li>
</ul>
<h4><code>app</code> - Legacy Android Application</h4>
<ul>
<li><strong>Purpose</strong>: Legacy Android application (being phased out)</li>
<li><strong>Key Components</strong>:</li>
<li><code>MainActivity</code> - Main application screen</li>
<li><code>DocumentActivity</code> - Document editing/viewing</li>
<li><code>SettingsActivity</code> - Application settings</li>
<li>Legacy Android UI components</li>
</ul>
<h3>Format Modules</h3>
<h4>Platform-Specific Format Implementations</h4>
<p>Each format is implemented natively for each platform:</p>
<p><code>format-[name]/
├── src/main/java/digital/vasic/yole/format/[name]/  # Android implementation
│   ├── [Name]TextConverter.java      # HTML conversion
│   ├── [Name]SyntaxHighlighter.java  # Editor highlighting
│   └── [Name]ActionButtons.java      # Toolbar actions
├── src/test/java/                    # Unit tests
└── src/androidTest/java/             # Integration tests</code></p>
<p>Platform-specific implementations are maintained separately for optimal performance and native integration.
shared/src/commonMain/kotlin/digital/vasic/yole/format/[name]/
├── [Name]Parser.kt                   # Common parsing logic
└── Platform-specific implementations
    ├── androidMain/[Name]Parser.android.kt
    ├── desktopMain/[Name]Parser.desktop.kt
    └── iosMain/[Name]Parser.ios.kt
```</p>
<h4>Legacy Android Format Modules</h4>
<p>Each format also has a legacy Android module for UI-specific components:</p>
<p><code>format-[name]/
├── src/main/java/digital/vasic/yole/format/[name]/
│   ├── [Name]TextConverter.java      # HTML conversion
│   ├── [Name]SyntaxHighlighter.java  # Editor highlighting
│   └── [Name]ActionButtons.java      # Toolbar actions
├── src/test/java/                    # Unit tests
└── src/androidTest/java/             # Integration tests</code></p>
<h2>Supported Formats</h2>
<h3>1. Markdown (<code>format-markdown</code>)</h3>
<ul>
<li><strong>Extensions</strong>: <code>.md</code></li>
<li><strong>Features</strong>: Full CommonMark support, KaTeX math rendering, tables, code blocks</li>
<li><strong>Dependencies</strong>: Flexmark library</li>
</ul>
<h3>2. Todo.txt (<code>format-todotxt</code>)</h3>
<ul>
<li><strong>Extensions</strong>: <code>.todo.txt</code></li>
<li><strong>Features</strong>: Task management, priorities, contexts, projects, due dates</li>
<li><strong>Special Features</strong>: Advanced search and filtering</li>
</ul>
<h3>3. CSV (<code>format-csv</code>)</h3>
<ul>
<li><strong>Extensions</strong>: <code>.csv</code></li>
<li><strong>Features</strong>: Table preview, column-based syntax highlighting, HTML export</li>
<li><strong>Dependencies</strong>: OpenCSV library</li>
</ul>
<h3>4. WikiText (<code>format-wikitext</code>)</h3>
<ul>
<li><strong>Extensions</strong>: <code>.txt</code></li>
<li><strong>Features</strong>: Zim wiki format, link resolution, transclusion</li>
<li><strong>Special Features</strong>: Attachment directory handling</li>
</ul>
<h3>5. Key-Value (<code>format-keyvalue</code>)</h3>
<ul>
<li><strong>Extensions</strong>: <code>.json</code>, <code>.yml</code>, <code>.yaml</code>, <code>.toml</code>, <code>.vcf</code>, <code>.ics</code>, <code>.ini</code></li>
<li><strong>Features</strong>: Structured data editing with syntax highlighting</li>
<li><strong>Supported Formats</strong>: JSON, YAML, TOML, INI, VCF (vCard), ICS (iCalendar)</li>
</ul>
<h3>6. AsciiDoc (<code>format-asciidoc</code>)</h3>
<ul>
<li><strong>Extensions</strong>: <code>.adoc</code></li>
<li><strong>Features</strong>: Technical documentation format</li>
<li><strong>Dependencies</strong>: AsciiDoctor.js</li>
</ul>
<h3>7. Org-mode (<code>format-orgmode</code>)</h3>
<ul>
<li><strong>Extensions</strong>: <code>.org</code></li>
<li><strong>Features</strong>: Emacs org-mode format, headings, TODO states, timestamps</li>
<li><strong>Dependencies</strong>: Org-mode JavaScript library</li>
</ul>
<h3>8. Plaintext (<code>format-plaintext</code>)</h3>
<ul>
<li><strong>Extensions</strong>: <code>.txt</code></li>
<li><strong>Features</strong>: Basic text editing with code syntax highlighting</li>
<li><strong>Special Features</strong>: Automatic language detection</li>
</ul>
<h3>9. LaTeX (<code>format-latex</code>) - NEW</h3>
<ul>
<li><strong>Extensions</strong>: <code>.tex</code>, <code>.latex</code></li>
<li><strong>Features</strong>:</li>
<li>LaTeX command highlighting</li>
<li>Math expression conversion to KaTeX</li>
<li>Basic document structure conversion</li>
<li>Comment highlighting</li>
<li><strong>Action Buttons</strong>: Common LaTeX commands, math delimiters, lists</li>
</ul>
<h3>10. reStructuredText (<code>format-restructuredtext</code>) - NEW</h3>
<ul>
<li><strong>Extensions</strong>: <code>.rst</code>, <code>.rest</code></li>
<li><strong>Features</strong>:</li>
<li>Header detection and conversion</li>
<li>Inline markup (<code>*bold*</code>, <code>**italic**</code>, <code>code</code>)</li>
<li>Code blocks</li>
<li>Basic list support</li>
<li><strong>Action Buttons</strong>: RST markup shortcuts</li>
</ul>
<h3>11. TaskPaper (<code>format-taskpaper</code>) - NEW</h3>
<ul>
<li><strong>Extensions</strong>: <code>.taskpaper</code></li>
<li><strong>Features</strong>:</li>
<li>Project-based task organization</li>
<li>Tag support</li>
<li>Note attachments</li>
<li><strong>Action Buttons</strong>: Task creation, project management</li>
</ul>
<h3>12. Textile (<code>format-textile</code>) - NEW</h3>
<ul>
<li><strong>Extensions</strong>: <code>.textile</code></li>
<li><strong>Features</strong>:</li>
<li>Lightweight markup similar to Markdown</li>
<li>Textile-specific syntax highlighting</li>
<li>HTML conversion</li>
<li><strong>Action Buttons</strong>: Textile formatting shortcuts</li>
</ul>
<h3>13. Creole (<code>format-creole</code>) - NEW</h3>
<ul>
<li><strong>Extensions</strong>: <code>.creole</code></li>
<li><strong>Features</strong>:</li>
<li>Wiki markup standard</li>
<li>Cross-wiki compatibility</li>
<li>Link and formatting support</li>
<li><strong>Action Buttons</strong>: Creole wiki markup</li>
</ul>
<h3>14. TiddlyWiki (<code>format-tiddlywiki</code>) - NEW</h3>
<ul>
<li><strong>Extensions</strong>: <code>.tid</code></li>
<li><strong>Features</strong>:</li>
<li>Personal wiki format</li>
<li>Structured data support</li>
<li>Link handling</li>
<li><strong>Action Buttons</strong>: Tiddler creation, linking</li>
</ul>
<h3>15. Jupyter (<code>format-jupyter</code>) - NEW</h3>
<ul>
<li><strong>Extensions</strong>: <code>.ipynb</code></li>
<li><strong>Features</strong>:</li>
<li>JSON-based notebook format</li>
<li>Code cell highlighting</li>
<li>Markdown cell support</li>
<li><strong>Action Buttons</strong>: Cell creation, notebook structure</li>
</ul>
<h3>16. R Markdown (<code>format-rmarkdown</code>) - NEW</h3>
<ul>
<li><strong>Extensions</strong>: <code>.Rmd</code></li>
<li><strong>Features</strong>:</li>
<li>R code integration</li>
<li>Markdown with R chunks</li>
<li>Output formatting</li>
<li><strong>Action Buttons</strong>: Code chunk insertion, R integration</li>
</ul>
<h2>Implementation Details</h2>
<h3>Format Registration</h3>
<p>Formats are registered in platform-specific registries:</p>
<p>```kotlin
object FormatRegistry {
    private val formats = mutableMapOf<String, TextFormat>()</p>
<pre><code>fun registerFormat(format: TextFormat) {
    formats[format.name] = format
}

fun getFormat(name: String): TextFormat? = formats[name]
</code></pre>
<p>}
```</p>
<h3>Text Parsing Pipeline</h3>
<ol>
<li><strong>File Detection</strong>: <code>TextFormat.detectFormat(content: String, extension: String)</code></li>
<li><strong>Markup Parsing</strong>: <code>TextParser.parse(content: String): Document</code></li>
<li><strong>Platform Rendering</strong>: Platform-specific converters to HTML/other formats</li>
<li><strong>Syntax Highlighting</strong>: Platform-specific syntax highlighters</li>
</ol>
<h3>Android Pipeline</h3>
<ol>
<li><strong>File Detection</strong>: <code>TextConverter.isFileOutOfThisFormat()</code></li>
<li><strong>Markup Parsing</strong>: <code>TextConverter.convertMarkupToHtml()</code></li>
<li><strong>HTML Rendering</strong>: WebView with format-specific CSS</li>
<li><strong>Syntax Highlighting</strong>: <code>SyntaxHighlighter.applySyntaxHighlighting()</code></li>
</ol>
<h3>Testing Strategy</h3>
<h4>Platform-Specific Tests</h4>
<ul>
<li><code>androidApp/src/test/</code>: Android unit tests</li>
<li><code>desktopApp/src/test/</code>: Desktop unit tests</li>
<li><code>iosApp/src/test/</code>: iOS unit tests</li>
<li><code>webApp/src/test/</code>: Web unit tests</li>
</ul>
<h4>Legacy Android Tests</h4>
<ul>
<li>Format detection accuracy</li>
<li>Markup conversion correctness</li>
<li>Syntax highlighting patterns</li>
<li>Action button functionality</li>
<li>UI component integration</li>
</ul>
<h4>E2E Tests</h4>
<ul>
<li>Full application workflows</li>
<li>Real device/emulator testing</li>
<li>Cross-platform compatibility testing</li>
</ul>
<h2>Build System</h2>
<h3>Gradle Configuration</h3>
<ul>
<li>Multi-platform project with 25+ modules</li>
<li>Version catalog for dependency management (<code>libs.versions.toml</code>)</li>
<li>Shared build logic in root <code>build.gradle.kts</code></li>
<li>Module-specific dependencies</li>
<li>Automated testing pipeline</li>
</ul>
<h3>Platform Dependencies</h3>
<ul>
<li><strong>Android</strong>: AndroidX, Material Design, Kotlin</li>
<li><strong>Desktop</strong>: Compose Desktop, Kotlin</li>
<li><strong>iOS</strong>: Platform-specific frameworks</li>
<li><strong>Web</strong>: WebAssembly, modern web technologies</li>
</ul>
<h3>Legacy Android Dependencies</h3>
<ul>
<li><strong>Core</strong>: AndroidX, Material Design</li>
<li><strong>Markdown</strong>: Flexmark library</li>
<li><strong>CSV</strong>: OpenCSV</li>
<li><strong>Math</strong>: KaTeX (via WebView)</li>
<li><strong>Testing</strong>: JUnit, AssertJ, Espresso</li>
</ul>
<h2>Development Guide</h2>
<h3>Platform Development</h3>
<ol>
<li>
<p><strong>Android Development</strong>:</p>
<ul>
<li>Use <code>androidApp/</code> module for modern Android development</li>
<li>Follow Android development best practices</li>
<li>Test on various Android devices and versions</li>
</ul>
</li>
<li>
<p><strong>Desktop Development</strong>:</p>
<ul>
<li>Use <code>desktopApp/</code> module for cross-platform desktop</li>
<li>Test on Windows, macOS, and Linux</li>
<li>Ensure native look and feel</li>
</ul>
</li>
<li>
<p><strong>iOS Development</strong>:</p>
<ul>
<li>Use <code>iosApp/</code> module for iOS development</li>
<li>Follow iOS development guidelines</li>
<li>Test on various iOS devices</li>
</ul>
</li>
<li>
<p><strong>Web Development</strong>:</p>
<ul>
<li>Use <code>webApp/</code> module for PWA development</li>
<li>Ensure responsive design</li>
<li>Test across modern browsers</li>
</ul>
</li>
</ol>
<h3>Code Organization</h3>
<ul>
<li>Keep platform-specific code in respective app modules</li>
<li>Share common utilities through <code>commons/</code> module</li>
<li>Use <code>core/</code> for shared Android functionality</li>
<li>Maintain format modules for extensibility</li>
</ul>
<h2>Future Enhancements</h2>
<h3>Planned Features</h3>
<ul>
<li>Plugin system for third-party formats</li>
<li>Cloud synchronization for all platforms</li>
<li>Advanced format conversion between types</li>
<li>Collaborative editing support</li>
<li>AI-powered features</li>
</ul>
<h3>Performance Optimizations</h3>
<ul>
<li>Lazy loading of format modules</li>
<li>Caching of converted content</li>
<li>Background processing for large files</li>
<li>Platform-specific optimizations</li>
</ul>
<h2>Contributing</h2>
<p>When adding new formats:</p>
<h3>Platform-Specific Implementation</h3>
<ol>
<li>Create new <code>format-[name]</code> module</li>
<li>Implement platform-specific parsers and converters</li>
<li>Add to platform-specific <code>FormatRegistry</code></li>
<li>Update string resources for each platform</li>
<li>Add comprehensive tests for each platform</li>
<li>Update documentation</li>
</ol>
<h3>Cross-Platform Considerations</h3>
<ul>
<li>Ensure consistent behavior across platforms</li>
<li>Handle platform-specific file system differences</li>
<li>Test on all target platforms</li>
<li>Maintain performance optimizations</li>
</ul>
<p>See existing format modules as reference implementations.</p>
    </main>

    <footer>
        <p>&copy; 2025 Yole Project</p>
    </footer>
</body>
</html>